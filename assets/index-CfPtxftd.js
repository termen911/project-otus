import{d as E,p as y,e as x,a as f,j as e,B as P,r as v,F as i,T as I}from"./index-CHNgfYCQ.js";import{u as F,F as t,I as p,h as b,s as h,C as q,D as g}from"./handleApiError-Di8xC1Pk.js";import{R as w}from"./LockOutlined-2kBE6tH8.js";import{R as D,M as C}from"./MainLayout-BIpuf614.js";const S={profile:["profile"]},T=()=>F({mutationFn:async r=>(await y.changePassword(r)).data}),L=()=>{const r=E();return F({mutationFn:async s=>(await y.updateProfile(s)).data,onSuccess:s=>{r.setQueryData(S.profile,s),x.getState().setProfile(s)},onError:s=>{console.error(s)}})},R=()=>{const[r]=t.useForm(),{t:s}=f("features.profile.change-password"),{mutate:n,isPending:l}=T(),m=u=>{n(u,{onSuccess:a=>{a.success?(h.success(s("success")),r.resetFields()):h.error(s("error"))},onError:a=>{const d=b(a);d.length>0&&r.setFields(d.map(c=>({name:c.fieldName,errors:[c.message]})))}})};return e.jsxs("div",{style:{maxWidth:400,margin:"30px 0 0"},children:[e.jsx("h3",{children:s("title")}),e.jsxs(t,{form:r,layout:"vertical",onFinish:m,children:[e.jsx(t.Item,{name:"password",label:s("currentPassword.label"),rules:[{required:!0,message:s("currentPassword.required")}],children:e.jsx(p.Password,{prefix:e.jsx(w,{}),placeholder:s("currentPassword.placeholder")})}),e.jsx(t.Item,{name:"newPassword",label:s("newPassword.label"),rules:[{required:!0,message:s("newPassword.required")},{min:6,message:s("newPassword.minLength")}],children:e.jsx(p.Password,{prefix:e.jsx(w,{}),placeholder:s("newPassword.placeholder")})}),e.jsx(t.Item,{children:e.jsx(P,{type:"primary",htmlType:"submit",loading:l,children:s("submit")})})]})]})},M=()=>{const[r]=t.useForm(),{t:s}=f("features.profile.edit-nickname"),n=x(a=>a.profile),{mutate:l,isPending:m}=L();v.useEffect(()=>{n&&r.setFieldsValue({name:n.name})},[n,r]);const u=a=>{l({name:a.name},{onSuccess:()=>{h.success(s("success"))},onError:d=>{const c=b(d);c.length>0&&r.setFields(c.map(j=>({name:j.fieldName,errors:[j.message]})))}})};return e.jsxs("div",{style:{maxWidth:400,margin:"0 auto"},children:[e.jsx("h3",{children:s("title")}),e.jsxs(t,{form:r,layout:"vertical",onFinish:u,children:[e.jsx(t.Item,{name:"name",label:s("name.label"),rules:[{required:!0,message:s("name.required")},{min:2,message:s("name.minLength")}],children:e.jsx(p,{prefix:e.jsx(D,{}),placeholder:s("name.placeholder")})}),e.jsx(t.Item,{children:e.jsx(P,{type:"primary",htmlType:"submit",loading:m,children:s("submit")})})]})]})},{Text:o}=I,k=()=>{const{t:r,currentLang:s}=f("pages.profile"),n=x(l=>l.profile);return n?e.jsx(C,{children:e.jsx(q,{title:r("title"),variant:"borderless",style:{width:"100%"},children:e.jsxs(i,{vertical:!0,style:{width:"100%"},children:[e.jsxs(i,{vertical:!0,align:"center",style:{marginBottom:24},children:[e.jsxs(i,{gap:16,justify:"start",children:[e.jsx(o,{strong:!0,children:r("info.name")})," ",e.jsx(o,{children:n.name??r("info.noName")})]}),e.jsxs(i,{gap:16,children:[e.jsx(o,{strong:!0,children:r("info.email")})," ",e.jsx(o,{children:n.email})]}),e.jsxs(i,{gap:16,children:[e.jsx(o,{strong:!0,children:r("info.signUpDate")})," ",e.jsx(o,{children:new Date(n.signUpDate).toLocaleDateString(s)})]})]}),e.jsx(g,{}),e.jsx(M,{}),e.jsx(g,{}),e.jsx(i,{justify:"center",children:e.jsx(R,{})})]})})}):e.jsx("div",{children:r("notFound")})};export{k as ProfilePage};
